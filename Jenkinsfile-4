node {
    def scannerHome = tool 'SonarQubeScanner';
    stage ("Image Prune"){
        sh "docker image prune -f"
    }
    stage ("Test") {
        echo "Testing Docker connection"
        sh "docker images"
    }
    stage("Push to Docker Registry"){
        withCredentials([usernamePassword(credentialsId:"dockerHubAccount",
        usernameVariable:"dockerUser",passwordVariable:"dockerPassword")])
        {
            sh "docker login -u $dockerUser -p $dockerPassword"
            echo "docker images are pushed successful"
        }
    } 
    stage('SCM'){
        checkout scm
    }
    stage('SonarQube Analysis') {
        withSonarQubeEnv() {
        sh "${scannerHome}/bin/sonar-scanner"
        }
    }
    stage('ansible inventory'){
        ansiblePlaybook inventory: 'hosts', playbook: 'deploy1.yml'
    
    }

}
